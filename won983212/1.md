# 1. 신뢰할 수 있고 확장 가능하며 유지보수하기 쉬운 애플리케이션

## 데이터 시스템

### 왜 `데이터 시스템`이라는 포괄적인 단어로 묶어 설명하는가?
 - 도구간 경계가 모호해져, 더 구체적인 단어로 정의하기 어렵다.
   - 예를 들어 kafka는 데이터베이스의 영속성과 메시지 큐의 특성을 모두 지니고 있다. 
 - 최근 애플리케이션들은 요구사항이 복잡해서, 단일 데이터 시스템(컴포넌트)으로는 구성하기 어렵다.

### 데이터 시스템에서 고민해야할 포인트 (이 책에서)
 - **신뢰성**: 결함으로부터 안전한지?
 - **확장성**: 데이터 규모/트래픽/복잡도가 증가해도 대응 가능한지?
 - **유지보수성**: 생산적으로 시스템을 관리할 수 있는지?

## 신뢰성

 - **결함**: 잘못될 수 있는 일. 스펙외의 시스템 구성 요소
   - **하드웨어 결함**: 하드웨어 자체에 결함이 발생하는 경우.
     - 하드웨어를 이중화하거나 소프트웨어 내결함성 기술을 사용해서 방지한다.
   - **소프트웨어 오류**: 시스템내 소프트웨어 설계 오류. 소프트웨어 결함을 발생시킨다.
     - 주의깊게 설계, 테스트, 프로세스 격리, 모니터링 등... 여러 방법을 동원해야함
   - **인적 오류**: 사람의 실수로 인한 결함.
     - 사람의 개입을 최소화하도록 설계하기, 철저한 테스트, 인적오류를 쉽게 롤백할 수 있게하기, 모니터링 환경 구축 등...
 - **장애**: 서비스를 제공하지 못하는 상태. 결함이 장애를 야기할 수 있다.

> ### 카오스 몽키
> 일부러 결함을 유도(랜덤으로 인스턴스 강제 종료)해 장애에 대비하는 엔지니어링 기법

## 확장성

부하가 증가에 대처할 수 있는 능력이다.

### 부하 기술하기

서버 초당 요청수, DB 읽기/쓰기 비율, active user 등의 지표를 사용해 부하를 기술할 수 있다.
  - 트위터는 개인화 캐시를 도입해 부하를 효과적으로 처리했다.
  - 다만 인플루언서들은 캐시 write비용이 너무 크므로, 따로 테이블에 저장해 쿼리로 처리하는 방식을 사용한다.

### 성능 기술하기

처리량이나 응답시간 등의 지표를 활용해 성능을 기술할 수 있다.
  - 응답시간 평균보다는 중간값이 사용자 입장에서 지연시간을 파악하는데에 좋은 지표다.
  - 백분위를 사용해 '최소 ~분위의 사용자들은 ~보다 빠르게 응답받았다'와 같이 성능을 기술할 수 있다.
  - 더 높은 분위를 사용할수록, 더 많은 사용자 개선을 이루겠지만 비용이 많이 소요된다.
  - 서버는 요청을 순차적으로 처리하므로(동시에 처리한다해도 최대 처리량이 정해져있음), HOL Blocking문제가 발생한다.
    - 따라서 서버 자체의 성능도 중요하지만, 클라이언트 측의 응답 시간도 중요한 지표이다.

### 부하 대응 접근 방식

부하가 증가하더라도 좋은 성능을 유지하기 위해서는?
 - **수직확장**: 시스템 설계가 단순해진다
 - **수평확장**: 부하를 예측하기 어려운 상황에서 유용
   - stateful 서버라면, 정합성을 고려하여 설계해야 한다. 더 복잡해짐
   - DB는 샤딩이 복잡해서 보통 단일 인스턴스로 쓰다가 필요한 경우 확장한다.

## 유지보수성

프로그램 스펙은 계속 변화한다. 변화에 빠르게 대응할 수 있는 능력을 유지보수성이라고 한다.

### 운용성

시스템을 쉽게 운영할 수 있게 만들자.

 - 인적 오류를 피하기 위한 자동화
 - 시스템 모니터링, 서비스 자동 복원
 - 시스템 문서화
 - 예측 가능하게 동작하도록 설계

### 단순성

시스템 설계를 이해하기 쉽게 설계하자.

 - 소프트웨어 규모가 커지면서 복잡도도 같이 증가한다.
 - 시스템이 복잡하면 변경시 실수할 여지가 생긴다.
 - 추상화를 사용하여 시스템을 이해하기 쉽게 만들 수 있다.

### 발전성

시스템을 쉽게 변경할 수 있게 설계하자.
 - 시스템 스펙 변경에 쉽게 대응할 수 있도록 설계해야한다.
 - 애자일은 변경에 빠르게 대응하기위한 개발방법론
